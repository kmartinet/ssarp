<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Assessing Spatial Autocorrelation • ssarp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assessing Spatial Autocorrelation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ssarp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Get_Data.html">Get Occurrence Records from GBIF</a></li>
    <li><a class="dropdown-item" href="../articles/Create_SAR.html">Create Species-Area Relationship</a></li>
    <li><a class="dropdown-item" href="../articles/Create_SpAR.html">Create Speciation-Area Relationship</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial_Autocorrelation.html">Assessing Spatial Autocorrelation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kmartinet/ssarp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Assessing Spatial Autocorrelation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kmartinet/ssarp/blob/main/vignettes/Spatial_Autocorrelation.Rmd" class="external-link"><code>vignettes/Spatial_Autocorrelation.Rmd</code></a></small>
      <div class="d-none name"><code>Spatial_Autocorrelation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Species-area relationships (SARs) and speciation-area relationships
(SpARs) are impacted by the environmental and spatial characteristics of
the islands (or island-like areas) of interest. When inferring SARs and
SpARs, researchers typically treat these effects as part of the broader
biogeographic processes that are captured by the SARs and SpARs
(Triantis et al. 2012). However, ignoring spatial effects when inferring
SARs and SpARs can result in biased parameter estimates (Barros et
al. 2023).</p>
<p>Testing for spatial autocorrelation, when data from spatially nearby
locations is not independent from each other, allows researchers to
determine whether these spatial effects are impacting parameter
estimates. This vignette provides an example of testing for spatial
autocorrelation for a dataset including species richness of Galápagos
finches. This dataset was created using the Galápagos finch
presence-absence matrix published with the <code>cooccur</code> R
package (Griffith et al. 2016), and then using <code>ssarp</code> to
associate those islands with their areas.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kmartinet/ssarp" class="external-link">ssarp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read in finch data</span></span>
<span><span class="va">finch_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                                  <span class="st">"finch_richness.csv"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"ssarp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print first 5 lines of finch_dat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">finch_dat</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          island     area richness</span></span>
<span><span class="co">## 1        Darwin   664000        3</span></span>
<span><span class="co">## 2          Wolf  1240000        3</span></span>
<span><span class="co">## 3 North Seymour  1910000        4</span></span>
<span><span class="co">## 4        Rabida  4970000        8</span></span>
<span><span class="co">## 5      Genovesa 13800000        4</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="testing-for-spatial-autocorrelation-using-morans-i">Testing for Spatial Autocorrelation using Moran’s I<a class="anchor" aria-label="anchor" href="#testing-for-spatial-autocorrelation-using-morans-i"></a>
</h2>
<p>Moran’s I (Moran 1950) is a commonly used metric for testing for
spatial autocorrelation in ecological data (Dormann et al. 2007). Here,
we will use the <code>spdep</code> R package to calculate Moran’s I for
our Galápagos finch data.</p>
<p>An important step in calculating Moran’s I is to identify spatial
neighbors in the dataset. In order to do this for our Galápagos finch
data, we need to load a shapefile for the Galápagos Islands. An
excellent shapefile is available from the <a href="https://geodata.fcdarwin.org.ec/catalogue/#/dataset/489" class="external-link">Galápagos
Geoportal</a>, and is included as an <code>.rda</code> file in the
<code>extdata</code> folder as part of <code>ssarp</code> for ease of
use in this vignette.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load shapefile. The object will be called "galap_shape"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                 <span class="st">"galapagos_islands.rda"</span>,</span>
<span>                  package <span class="op">=</span> <span class="st">"ssarp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we will merge the finch data with the Galápagos shapefile.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge shapefile (galap_shape) with finch data (finch_dat) by </span></span>
<span><span class="co">#  the island name ("nombre" in the shapefile and "island" in the finch data)</span></span>
<span><span class="va">islands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">galap_shape</span>, </span>
<span>                 y <span class="op">=</span> <span class="va">finch_dat</span>,</span>
<span>                 by.x <span class="op">=</span> <span class="st">"nombre"</span>,</span>
<span>                 by.y <span class="op">=</span> <span class="st">"island"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can use the newly created <code>islands</code> spatial object
to calculate the distance between neighboring islands and create a list
of spatial weights necessary for calculating Moran’s I. We will
accomplish this goal using distances between centroids of all of the
islands on which finches occur.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find coordinates for the centroids of all of the islands </span></span>
<span><span class="co">#  to use in the neighbor calculation</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">islands</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify centroid neighbors for each island</span></span>
<span><span class="co"># d1: lower bound for distance</span></span>
<span><span class="co"># d2: upper bound for distance</span></span>
<span><span class="co"># Islands are considered neighbors if the distance is between d1 and d2</span></span>
<span></span>
<span><span class="co"># d2 is 30000m in this example, informed by prior distance calculations within</span></span>
<span><span class="co">#  the Galápagos archipelago</span></span>
<span><span class="va">neighbors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/dnearneigh.html" class="external-link">dnearneigh</a></span><span class="op">(</span><span class="va">coords</span>, d1 <span class="op">=</span> <span class="fl">0</span>, d2 <span class="op">=</span> <span class="fl">30000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign spatial weights to the neighbors list for use in the Moran test</span></span>
<span><span class="co"># style = "W": row-standardized, which is the most-commonly used (Dormann et al. 2007)</span></span>
<span><span class="va">neighbor_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">nb2listw</a></span><span class="op">(</span><span class="va">neighbors</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can run the Moran’s I test to determine whether Galápagos
finch richness is biased by spatial autocorrelation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># zero.policy = TRUE allows for islands to have no neighbors</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html" class="external-link">moran.test</a></span><span class="op">(</span><span class="va">islands</span><span class="op">$</span><span class="va">richness</span>, <span class="va">neighbor_weights</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Moran I test under randomisation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  islands$richness  </span></span>
<span><span class="co">## weights: neighbor_weights    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Moran I statistic standard deviate = 0, p-value = 0.5</span></span>
<span><span class="co">## alternative hypothesis: greater</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">##     -5.882353e-02     -5.882353e-02      5.421011e-17</span></span></code></pre>
<p>With a p-value of 0.5, we can conclude that Galápagos finch species
richness is not spatially structured. We can also conclude that the SAR
for Galápagos finches is not driven by the structure of geographic
distances between the islands on which they occur.</p>
<p>As a note of caution, this result is only indicative of a particular
spatial grain and the particular species included here. Species richness
might be spatially structured at a different grain (for example, between
habitat fragments), but not at the island level. We encourage
researchers to fully explore the potential of spatial autocorrelation in
their datasets before drawing conclusions about the parameters of SARs
and SpARs.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Barros, D.D., Mathias, M.d.L., Borges, P.A.V., &amp; Borda-de-Água,
L. (2023). The Importance of Including Spatial Autocorrelation When
Modelling Species Richness in Archipelagos: A Bayesian Approach.
Diversity, 15: 127. <a href="https://doi.org/10.3390/d15020127" class="external-link uri">https://doi.org/10.3390/d15020127</a>
</li>
<li>Dormann, C.F., McPherson, J.M, Araújo, M.B., Bivand, R., Bolliger,
J., Carl, G., Davies, R.G., Hirzel, A., Jetz, W., Kissling, W.D., Kühn,
I., Ohlemüller, R., Peres-Neto, P.R., Reineking, B., Schröder, B.,
Schurr, F.M., &amp; Wilson, R. (2007). Methods to account for spatial
autocorrelation in the analysis of species distributional data: a
review. Ecography, 30: 609-628. <a href="https://doi.org/10.1111/j.2007.0906-7590.05171.x" class="external-link uri">https://doi.org/10.1111/j.2007.0906-7590.05171.x</a>
</li>
<li>Griffith, D.M., Veech, J.A., &amp; Marsh, C.J. (2016). cooccur:
Probabilistic Species Co-Occurrence Analysis in R. Journal of
Statistical Software, Code Snippets, 69(2): 1–17. <a href="https://doi.org/10.18637/jss.v069.c02" class="external-link uri">https://doi.org/10.18637/jss.v069.c02</a>
</li>
<li>Moran, P.A.P. (1950). Notes on Continuous Stochastic Phenomena.
Biometrika, 37(1/2): 17-23. <a href="https://doi.org/10.2307/2332142" class="external-link uri">https://doi.org/10.2307/2332142</a>
</li>
<li>Triantis, K.A., Guilhaumon, F., &amp; Whittaker, R.J. (2012), The
island species–area relationship: biology and statistics. Journal of
Biogeography, 39: 215-231. <a href="https://doi.org/10.1111/j.1365-2699.2011.02652.x" class="external-link uri">https://doi.org/10.1111/j.1365-2699.2011.02652.x</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kristen Martinet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
